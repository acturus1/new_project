<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Админ-панель</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="admin-container">
        <!-- Боковое меню -->
        <nav class="sidebar">
            <div class="logo">
                <i class="fas fa-crown"></i>
                <span>ADMIN</span>
            </div>
            
            <ul class="nav-menu">
                <li class="active"><a href="#dashboard"><i class="fas fa-tachometer-alt"></i> Дашборд</a></li>
                <li><a href="#users"><i class="fas fa-users"></i> Пользователи</a></li>
                <li><a href="#games"><i class="fas fa-gamepad"></i> Игры</a></li>
                <li><a href="#settings"><i class="fas fa-cog"></i> Настройки</a></li>
                <li><a href="#jackpot"><i class="fas fa-trophy"></i> Джекпот</a></li>
                <li><a href="/admin/logout"><i class="fas fa-sign-out-alt"></i> Выход</a></li>
            </ul>
        </nav>

        <!-- Основной контент -->
        <main class="main-content">
            <!-- Заголовок -->
            <header class="admin-header">
                <h1><i class="fas fa-tachometer-alt"></i> Панель управления</h1>
                <div class="admin-info">
                    <span>Администратор: {{ current_user.username }}</span>
                </div>
            </header>

            <!-- Статистика -->
            <section id="dashboard" class="dashboard-section">
                <h2><i class="fas fa-chart-line"></i> Статистика</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Всего игроков</h3>
                            <div class="stat-value">{{ total_users }}</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-gamepad"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Всего игр</h3>
                            <div class="stat-value">{{ total_games }}</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-coins"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Общие ставки</h3>
                            <div class="stat-value">{{ total_bets }} ₽</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-trophy"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Общие выигрыши</h3>
                            <div class="stat-value">{{ total_wins }} ₽</div>
                        </div>
                    </div>
                </div>
                
                <!-- Последние игры -->
                <div class="recent-games">
                    <h3><i class="fas fa-history"></i> Последние игры</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Игрок</th>
                                <th>Ставка</th>
                                <th>Выигрыш</th>
                                <th>Символы</th>
                                <th>Время</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for game in recent_games %}
                            <tr>
                                <td>{{ game.id }}</td>
                                <td>{{ game.user.username if game.user else 'N/A' }}</td>
                                <td>{{ game.bet_amount }} ₽</td>
                                <td class="{{ 'win' if game.is_win else 'loss' }}">
                                    {{ game.win_amount }} ₽
                                </td>
                                <td>{{ game.symbols }}</td>
                                <td>{{ game.created_at.strftime('%H:%M:%S') }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Настройки -->
            <section id="settings" class="settings-section" style="display: none;">
                <h2><i class="fas fa-cog"></i> Настройки системы</h2>
                
                <div class="settings-form">
                    <div class="form-group">
                        <label>Минимальная ставка:</label>
                        <input type="number" id="min_bet" value="{{ settings.min_bet }}" min="1">
                    </div>
                    
                    <div class="form-group">
                        <label>Максимальная ставка:</label>
                        <input type="number" id="max_bet" value="{{ settings.max_bet }}" min="10">
                    </div>
                    
                    <div class="form-group">
                        <label>Доля казино (%):</label>
                        <input type="number" id="house_edge" value="{{ settings.house_edge * 100 }}" min="0" max="50" step="0.1">
                    </div>
                    
                    <div class="form-group">
                        <label>Шанс джекпота (%):</label>
                        <input type="number" id="jackpot_chance" value="{{ settings.jackpot_chance * 100 }}" min="0" max="10" step="0.01">
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="is_maintenance" {% if settings.is_maintenance %}checked{% endif %}>
                            Режим обслуживания
                        </label>
                    </div>
                    
                    <button class="btn-save" onclick="saveSettings()">
                        <i class="fas fa-save"></i> Сохранить настройки
                    </button>
                </div>
            </section>

            <!-- Управление джекпотом -->
            <section id="jackpot" class="jackpot-section" style="display: none;">
                <h2><i class="fas fa-trophy"></i> Управление джекпотом</h2>
                
                <div class="jackpot-info">
                    <div class="jackpot-card">
                        <div class="jackpot-amount">
                            <h3>Текущий джекпот</h3>
                            <div class="amount">{{ jackpot.amount }} ₽</div>
                        </div>
                        
                        <div class="jackpot-history">
                            <h3>Последний победитель</h3>
                            <div class="winner-info">
                                {% if jackpot.last_winner %}
                                <p><strong>Игрок:</strong> {{ jackpot.last_winner }}</p>
                                <p><strong>Дата:</strong> {{ jackpot.last_win_date.strftime('%d.%m.%Y %H:%M') if jackpot.last_win_date else 'Нет данных' }}</p>
                                {% else %}
                                <p>Джекпот еще не выигрывали</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="jackpot-controls">
                        <button class="btn-reset" onclick="resetJackpot()">
                            <i class="fas fa-redo"></i> Сбросить джекпот
                        </button>
                        
                        <div class="form-group">
                            <label>Установить сумму джекпота:</label>
                            <div class="input-group">
                                <input type="number" id="set_jackpot" value="5000" min="1000">
                                <button class="btn-set" onclick="setJackpot()">Установить</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script src="{{ url_for('static', filename='js/admin.js') }}"></script>
</body>
</html>
